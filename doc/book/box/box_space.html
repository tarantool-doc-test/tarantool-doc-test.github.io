




<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>3.4.2. Package box.space</title>
    <link rel="shortcut icon" href="/theme/favicon.ico" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.6.7-521-g0d75d50',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script type="text/javascript" src="../../_static/jquery.pin.min.js"></script>
    <script type="text/javascript" src="../../_static/headers.js"></script>
    <link rel="stylesheet" href="/theme/design.css">
    <link rel="stylesheet" href="/theme/pygmentize.css">
    <link rel="stylesheet" href="../../_static/sphinx_design.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
     
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


  </head>
  
  <body class="p-cols_design">
  
    <div class="b-wrapper">
      <!-- HEADER > -->
      <header class="b-header">
        <div class="b-header-wrapper">
          <nav class="b-header_menu">
            
  <ul class="b-menu">
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org" class="b-menu-item-url">Overview</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/doc/" class="b-menu-item-url p-active">Documentation</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/download.html" class="b-menu-item-url">Download</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/careers.html" class="b-menu-item-url">Careers</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
        
      </li>
    
  </ul>

          </nav>
        </div>
      </header>
      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  
  <section class="b-lightgray_block b-documentation_top b-clearbox p-documentation_in">
  
    <div class="b-block-wrapper">
      <h2 class="b-section-title">3.4.2. Package <cite>box.space</cite></h2>
      
    </div>
  </section>
  <div class="b-cols_content b-clearbox">
    <div class="b-cols_content_left">
      
      
<form id="searchbox" role="search" class="search b-search" action="../../search.html" method="get">
  <input class="b-search-text" name="q" type="text"/ placeholder="Search the manual">
  <input class="b-search-but" type="submit" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>


      
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../reference/index.html">Reference Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../reference/box.html">Package <cite>box</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/box_error.html">Package <cite>box.error</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/clock.html">Package <cite>clock</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/console.html">Package <cite>console</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/csv.html">Package <cite>csv</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/digest.html">Package <cite>digest</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/expirationd.html">Package <cite>expirationd</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fiber.html">Package <cite>fiber</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fiber-ipc.html">Package <cite>fiber-ipc</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fio.html">Package <cite>fio</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fun.html">Package <cite>fun</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/jit.html">Package <cite>jit</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/json.html">Package <cite>json</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/log.html">Package <cite>log</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/msgpack.html">Package <cite>msgpack</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/net_box.html">Package <cite>net.box</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/pickle.html">Package <cite>pickle</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/shard.html">Package <cite>shard</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/socket.html">Package <cite>socket</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/strict.html">Package <cite>strict</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/tap.html">Package <cite>tap</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/tarantool.html">Package <cite>tarantool</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/uuid.html">Package <cite>uuid</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/yaml.html">Package <cite>yaml</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/other.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/capi.html">Module C API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributing</a></li>
</ul>

    </div>
    <div class="b-cols_content_right">
      <div class="b-cols_content_right-slot">
  

<div class="b-page_header">
  <ul class="b-path-list">
    <li class="b-path-list-item">
      <a href="/doc/" class="b-path-list-item-url">Documentation</a>
    </li>
  
    <li class="b-path-list-item">
      <a href="../../reference/index.html" class="b-path-list-item-url">Reference Manual</a>
    </li>
  
    <li class="b-path-list-item">
      <a href="../../reference/box.html" class="b-path-list-item-url">Package <cite>box</cite></a>
    </li>
  
    <li class="b-path-list-item"><span class="b-path_current">3.4.2. Package <cite>box.space</cite></span></li>
  </ul>
</div>

<article class="b-article">
          
          
  <div class="section" id="package-box-space">
<h1>3.4.2. Package <cite>box.space</cite><a class="headerlink" href="#package-box-space" title="Ссылка на этот заголовок">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">box.space</span></code> package has the data-manipulation functions <code class="docutils literal"><span class="pre">select</span></code>,
<code class="docutils literal"><span class="pre">insert</span></code>, <code class="docutils literal"><span class="pre">replace</span></code>, <code class="docutils literal"><span class="pre">update</span></code>, <code class="docutils literal"><span class="pre">upsert</span></code>, <code class="docutils literal"><span class="pre">delete</span></code>, <code class="docutils literal"><span class="pre">get</span></code>, <code class="docutils literal"><span class="pre">put</span></code>.
It also has members, such as id, and whether or not a space is enabled. Package
source code is available in file
<a class="reference external" href="https://github.com/tarantool/tarantool/blob/master/src/box/lua/schema.lua">src/box/lua/schema.lua</a>.</p>
<p>A list of all <code class="docutils literal"><span class="pre">box.space</span></code> functions follows, then comes a list of all
<code class="docutils literal"><span class="pre">box.space</span></code> members.</p>
<blockquote>
<div><p><a class="reference internal" href="#lua-function.space_object.create_index" title="space_object.create_index"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:create_index()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.insert" title="space_object.insert"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:insert()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.select" title="space_object.select"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:select()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.get" title="space_object.get"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:get()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.drop" title="space_object.drop"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:drop()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.rename" title="space_object.rename"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:rename()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.replace" title="space_object.replace"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:replace()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.replace" title="space_object.replace"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:put()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.update" title="space_object.update"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:update()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.upsert" title="space_object.upsert"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:upsert()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.delete" title="space_object.delete"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:delete()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.len" title="space_object.len"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:len()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.truncate" title="space_object.truncate"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:truncate()</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.inc" title="space_object.inc"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:inc{}</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.dec" title="space_object.dec"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:dec{}</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.auto_increment" title="space_object.auto_increment"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:auto_increment{}</span></code></a> <br />
<a class="reference internal" href="#lua-function.space_object.pairs" title="space_object.pairs"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:pairs()</span></code></a>
<a class="reference internal" href="#lua-data.space_object.id" title="space_object.id"><code class="xref lua lua-func docutils literal"><span class="pre">space_object.id</span></code></a> <br />
<a class="reference internal" href="#lua-data.space_object.enabled" title="space_object.enabled"><code class="xref lua lua-func docutils literal"><span class="pre">space_object.enabled</span></code></a> <br />
<a class="reference internal" href="#lua-data.space_object.field_count" title="space_object.field_count"><code class="xref lua lua-func docutils literal"><span class="pre">space_object.field_count</span></code></a> <br />
<a class="reference internal" href="#lua-data.space_object.index" title="space_object.index"><code class="xref lua lua-func docutils literal"><span class="pre">space_object.index</span></code></a> <br /></p>
<p><a class="reference internal" href="#lua-data.box.space._schema" title="box.space._schema"><code class="xref lua lua-class docutils literal"><span class="pre">box.space._schema</span></code></a> <br />
<a class="reference internal" href="#lua-data.box.space._space" title="box.space._space"><code class="xref lua lua-class docutils literal"><span class="pre">box.space._space</span></code></a> <br />
<a class="reference internal" href="#lua-data.box.space._index" title="box.space._index"><code class="xref lua lua-class docutils literal"><span class="pre">box.space._index</span></code></a> <br />
<a class="reference internal" href="#lua-data.box.space._user" title="box.space._user"><code class="xref lua lua-class docutils literal"><span class="pre">box.space._user</span></code></a> <br />
<a class="reference internal" href="#lua-data.box.space._priv" title="box.space._priv"><code class="xref lua lua-class docutils literal"><span class="pre">box.space._priv</span></code></a> <br />
<a class="reference internal" href="#lua-data.box.space._cluster" title="box.space._cluster"><code class="xref lua lua-class docutils literal"><span class="pre">box.space._cluster</span></code></a>  <br /></p>
</div></blockquote>
<span class="target" id="lua-module.box.space"></span><dl class="class">
<dt id="lua-object.box.space.space_object">
<em class="property">object </em><code class="descname">space_object</code><a class="headerlink" href="#lua-object.box.space.space_object" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="method">
<dt id="lua-function.space_object.create_index">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">create_index</code><big>(</big><em>index-name</em><span class="optional">[</span>, <em>{options}</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#lua-function.space_object.create_index" title="Ссылка на это определение">¶</a></dt>
<dd><p>Create an index. It is mandatory to create an index for a tuple set
before trying to insert tuples into it, or select tuples from it. The
first created index, which will be used as the primary-key index, must be
unique.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">index_name</span> (type = string) = name of index, which should not be a number and
should not contain special characters;
<span class="ccodei">options</span>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">index object</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">index_object</td>
</tr>
</tbody>
</table>
<div class="table container">
<p>Options for <code class="docutils literal"><span class="pre">space_object:create_index</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="24%" />
<col width="34%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Effect</th>
<th class="head">Type</th>
<th class="head">Default</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>type</td>
<td>type of index</td>
<td>string
('HASH',     'TREE',
'BITSET',   'RTREE')</td>
<td>'TREE'</td>
</tr>
<tr class="row-odd"><td>id</td>
<td>unique identifier</td>
<td>number</td>
<td>last index's id, +1</td>
</tr>
<tr class="row-even"><td>unique</td>
<td>index is unique</td>
<td>boolean</td>
<td>true</td>
</tr>
<tr class="row-odd"><td>if_not_exists</td>
<td>no error if
duplicate name</td>
<td>boolean</td>
<td>false</td>
</tr>
<tr class="row-even"><td>parts</td>
<td>field-numbers  +
types</td>
<td><code class="docutils literal"><span class="pre">{field_no,</span> <span class="pre">'NUM'|'STR'}</span></code></td>
<td><code class="docutils literal"><span class="pre">{1,</span> <span class="pre">'NUM'}</span></code></td>
</tr>
</tbody>
</table>
</div>
<p>Possible errors: too many parts. A type option other than TREE, or a
unique option other than unique, or a parts option with more than one
field component, is only applicable for the memtx storage engine.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space55</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span><span class="p">}})</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.insert">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">insert</code><big>(</big><em>tuple</em><big>)</big><a class="headerlink" href="#lua-function.space_object.insert" title="Ссылка на это определение">¶</a></dt>
<dd><p>Insert a tuple into a space.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">tuple</span> (type = Lua table or tuple) = tuple to be inserted.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the inserted tuple</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: If a tuple with the same unique-key value already exists,
returns <a class="reference internal" href="../app/a_errcodes.html#errcode-ER_TUPLE_FOUND"><code class="xref std std-errcode docutils literal"><span class="pre">ER_TUPLE_FOUND</span></code></a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">5000</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">tuple number five thousand&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">5000</span><span class="p-Indicator">,</span> <span class="s">&#39;tuple</span><span class="nv"> </span><span class="s">number</span><span class="nv"> </span><span class="s">five</span><span class="nv"> </span><span class="s">thousand&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.select">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">select</code><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#lua-function.space_object.select" title="Ссылка на это определение">¶</a></dt>
<dd><p>Search for a tuple or a set of tuples in the given space.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">key</span> (type = Lua table or scalar) = key to be matched against the index
key, which may be multi-part.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the tuples whose primary-key fields are equal to the passed
field-values. If the number of passed field-values is less
than the number of fields in the primary key, then only the
passed field-values are compared, so <code class="docutils literal"><span class="pre">select{1,2}</span></code> will match
a tuple whose primary key is <code class="docutils literal"><span class="pre">{1,2,3}</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: No such space; wrong type.</p>
<p><strong>Complexity Factors:</strong> Index size, Index type.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tmp&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">temporary</span><span class="o">=</span><span class="kc">true</span><span class="p">})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,{</span><span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span><span class="p">}})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">A&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;A&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">B&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;B&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">C&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;C&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">D&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">2</span><span class="p-Indicator">,</span> <span class="s">&#39;D&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="c1">-- must equal both primary-key fields</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">B&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;B&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="c1">-- must equal only one primary-key field</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;A&#39;</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;B&#39;</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;C&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="c1">-- must equal 0 fields, so returns all tuples</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">{}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;A&#39;</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;B&#39;</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;C&#39;</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">2</span><span class="p-Indicator">,</span> <span class="s">&#39;D&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>For examples of complex <code class="docutils literal"><span class="pre">select</span></code> requests, where one can specify which
index to search and what condition to use (for example &quot;greater than&quot;
instead of &quot;equal to&quot;) and how many tuples to return, see the later section
<a class="reference internal" href="box_index.html#index-object-select"><span>index_object:select</span></a>.</p>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.get">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">get</code><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#lua-function.space_object.get" title="Ссылка на это определение">¶</a></dt>
<dd><p>Search for a tuple in the given space.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">key</span> (type = Lua table or scalar) = key to be matched against the index
key, which may be multi-part.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the selected tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: If space_object does not exist.</p>
<p><strong>Complexity Factors:</strong> Index size, Index type,
Number of indexes accessed, WAL settings.</p>
<p>The <code class="docutils literal"><span class="pre">box.space...select</span></code> function returns a set
of tuples as a Lua table; the <code class="docutils literal"><span class="pre">box.space...get</span></code>
function returns a single tuple. And it is possible to get
the first tuple in a tuple set by appending <code class="docutils literal"><span class="pre">[1]</span></code>.
Therefore <code class="docutils literal"><span class="pre">box.space.tester:get{1}</span></code> has the same
effect as <code class="docutils literal"><span class="pre">box.space.tester:select{1}[1]</span></code>, and
may serve as a convenient shorthand.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">get</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.drop">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">drop</code><big>(</big><big>)</big><a class="headerlink" href="#lua-function.space_object.drop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Drop a space.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p>Possible errors: If space_object does not exist.</p>
<p><strong>Complexity Factors:</strong> Index size, Index type,
Number of indexes accessed, WAL settings.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space_that_does_not_exist</span><span class="p">:</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.rename">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">rename</code><big>(</big><em>space-name</em><big>)</big><a class="headerlink" href="#lua-function.space_object.rename" title="Ссылка на это определение">¶</a></dt>
<dd><p>Rename a space.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">space-name</span> (type = string) = new name for space.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p>Possible errors: space_object does not exist.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space55</span><span class="p">:</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space56&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space56</span><span class="p">:</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space55&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.replace">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">replace</code><big>(</big><em>tuple</em><big>)</big><a class="headerlink" href="#lua-function.space_object.replace" title="Ссылка на это определение">¶</a></dt>
<dt id="lua-function.space_object.put">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">put</code><big>(</big><em>tuple</em><big>)</big><a class="headerlink" href="#lua-function.space_object.put" title="Ссылка на это определение">¶</a></dt>
<dd><p>Insert a tuple into a space. If a tuple with the same primary key already
exists, <code class="docutils literal"><span class="pre">box.space...:replace()</span></code> replaces the existing tuple with a new
one. The syntax variants <code class="docutils literal"><span class="pre">box.space...:replace()</span></code> and
<code class="docutils literal"><span class="pre">box.space...:put()</span></code> have the same effect; the latter is sometimes used
to show that the effect is the converse of <code class="docutils literal"><span class="pre">box.space...:get()</span></code>.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">tuple</span> (type = Lua table or tuple) = tuple to be inserted.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the inserted tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: If a different tuple with the same unique-key
value already exists, returns <a class="reference internal" href="../app/a_errcodes.html#errcode-ER_TUPLE_FOUND"><code class="xref std std-errcode docutils literal"><span class="pre">ER_TUPLE_FOUND</span></code></a>. (This
would only happen if there was a secondary index. By default
secondary indexes are unique)</p>
<p><strong>Complexity Factors:</strong> Index size, Index type,
Number of indexes accessed, WAL settings.</p>
<p><strong>Example:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">replace</span><span class="p">{</span><span class="mi">5000</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">tuple number five thousand&#39;</span><span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.update">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">update</code><big>(</big><em>key</em>, <em>{{operator</em>, <em>field_no</em>, <em>value}</em>, <em>...}</em><big>)</big><a class="headerlink" href="#lua-function.space_object.update" title="Ссылка на это определение">¶</a></dt>
<dd><p>Update a tuple.</p>
<p>The <code class="docutils literal"><span class="pre">update</span></code> function supports operations on fields — assignment,
arithmetic (if the field is unsigned numeric), cutting and pasting
fragments of a field, deleting or inserting a field. Multiple
operations can be combined in a single update request, and in this
case they are performed atomically and sequentially. Each operation
requires specification of a field number. When multiple operations
are present, the field number for each operation is assumed to be
relative to the most recent state of the tuple, that is, as if all
previous operations in a multi-operation update have already been
applied. In other words, it is always safe to merge multiple <code class="docutils literal"><span class="pre">update</span></code>
invocations into a single invocation, with no change in semantics.</p>
<p>Possible operators are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">+</span></code> for addition (values must be numeric)</li>
<li><code class="docutils literal"><span class="pre">-</span></code> for subtraction (values must be numeric)</li>
<li><code class="docutils literal"><span class="pre">&amp;</span></code> for bitwise AND (values must be unsigned numeric)</li>
<li><code class="docutils literal"><span class="pre">|</span></code> for bitwise OR (values must be unsigned numeric)</li>
<li><code class="docutils literal"><span class="pre">^</span></code> for bitwise <abbr title="exclusive OR">XOR</abbr> (values must be unsigned numeric)</li>
<li><code class="docutils literal"><span class="pre">:</span></code> for string splice</li>
<li><code class="docutils literal"><span class="pre">!</span></code> for insertion</li>
<li><code class="docutils literal"><span class="pre">#</span></code> for deletion</li>
<li><code class="docutils literal"><span class="pre">=</span></code> for assignment</li>
</ul>
</div></blockquote>
<p>For <code class="docutils literal"><span class="pre">!</span></code> and <code class="docutils literal"><span class="pre">=</span></code> operations the field number can be <code class="docutils literal"><span class="pre">-1</span></code>, meaning the last field in the tuple.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">key</span> (type = Lua table or scalar) = primary-key field values, must be passed as a Lua
table if key is multi-part;
<span class="ccodei">{operator, field_no, value}</span> (type = table): a group of arguments for each
operation, indicating what the operation is, what field the
operation will apply to, and what value will be applied. The
field number can be negative, meaning the position from the
end of tuple (#tuple + negative field number + 1).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the updated tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: it is illegal to modify a primary-key field.</p>
<p><strong>Complexity Factors:</strong> Index size, Index type, number of indexes accessed, WAL
settings.</p>
<p>Thus, in the instruction:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">s</span><span class="p">:</span><span class="n">update</span><span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">+&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">55</span> <span class="p">},</span> <span class="p">{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">x&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>the primary-key value is <code class="docutils literal"><span class="pre">44</span></code>, the operators are <code class="docutils literal"><span class="pre">'+'</span></code> and <code class="docutils literal"><span class="pre">'='</span></code> meaning
<em>add a value to a field and then assign a value to a field</em>, the first
affected field is field <code class="docutils literal"><span class="pre">1</span></code> and the value which will be added to it is
<code class="docutils literal"><span class="pre">55</span></code>, the second affected field is field <code class="docutils literal"><span class="pre">3</span></code> and the value which will be
assigned to it is <code class="docutils literal"><span class="pre">'x'</span></code>.</p>
<p><strong>Example:</strong></p>
<p>Assume that the initial state of the database is <code class="docutils literal"><span class="pre">tester</span></code> that has
one tuple set and one primary key whose type is <code class="docutils literal"><span class="pre">NUM</span></code>.
There is one tuple, with <code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code> and <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'A'</span></code>.</p>
<p>In the update:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">(</span><span class="mi">999</span><span class="p">,</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">B&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>The first argument is <code class="docutils literal"><span class="pre">tester</span></code>, that is, the affected space is <code class="docutils literal"><span class="pre">tester</span></code>.
The second argument is <code class="docutils literal"><span class="pre">999</span></code>, that is, the affected tuple is identified by
primary key value = 999.
The third argument is <code class="docutils literal"><span class="pre">=</span></code>, that is, there is one operation —
<em>assignment to a field</em>.
The fourth argument is <code class="docutils literal"><span class="pre">2</span></code>, that is, the affected field is <code class="docutils literal"><span class="pre">field[2]</span></code>.
The fifth argument is <code class="docutils literal"><span class="pre">'B'</span></code>, that is, <code class="docutils literal"><span class="pre">field[2]</span></code> contents change to <code class="docutils literal"><span class="pre">'B'</span></code>.
Therefore, after this update, <code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code> and <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'B'</span></code>.</p>
<p>In the update:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">999</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">B&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>the arguments are the same, except that the key is passed as a Lua table
(inside braces). This is unnecessary when the primary key has only one
field, but would be necessary if the primary key had more than one field.
Therefore, after this update, <code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code> and <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'B'</span></code> (no change).</p>
<p>In the update:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">999</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">}})</span>
</pre></div>
</div>
<p>the arguments are the same, except that the fourth argument is <code class="docutils literal"><span class="pre">3</span></code>,
that is, the affected field is <code class="docutils literal"><span class="pre">field[3]</span></code>. It is okay that, until now,
<code class="docutils literal"><span class="pre">field[3]</span></code> has not existed. It gets added. Therefore, after this update,
<code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code>, <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'B'</span></code>, <code class="docutils literal"><span class="pre">field[3]</span></code> = <code class="docutils literal"><span class="pre">1</span></code>.</p>
<p>In the update:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">999</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">+&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">}})</span>
</pre></div>
</div>
<p>the arguments are the same, except that the third argument is <code class="docutils literal"><span class="pre">'+'</span></code>,
that is, the operation is addition rather than assignment. Since
<code class="docutils literal"><span class="pre">field[3]</span></code> previously contained <code class="docutils literal"><span class="pre">1</span></code>, this means we're adding <code class="docutils literal"><span class="pre">1</span></code>
to <code class="docutils literal"><span class="pre">1</span></code>. Therefore, after this update, <code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code>,
<code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'B'</span></code>, <code class="docutils literal"><span class="pre">field[3]</span></code> = <code class="docutils literal"><span class="pre">2</span></code>.</p>
<p>In the update:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">999</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">|&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">C&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>the idea is to modify two fields at once. The formats are <code class="docutils literal"><span class="pre">'|'</span></code> and
<code class="docutils literal"><span class="pre">=</span></code>, that is, there are two operations, OR and assignment. The fourth
and fifth arguments mean that <code class="docutils literal"><span class="pre">field[3]</span></code> gets OR'ed with <code class="docutils literal"><span class="pre">1</span></code>. The
seventh and eighth arguments mean that <code class="docutils literal"><span class="pre">field[2]</span></code> gets assigned <code class="docutils literal"><span class="pre">'C'</span></code>.
Therefore, after this update, <code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code>, <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'C'</span></code>,
<code class="docutils literal"><span class="pre">field[3]</span></code> = <code class="docutils literal"><span class="pre">3</span></code>.</p>
<p>In the update:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">999</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">#&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;</span><span class="s">-&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}})</span>
</pre></div>
</div>
<p>The idea is to delete <code class="docutils literal"><span class="pre">field[2]</span></code>, then subtract <code class="docutils literal"><span class="pre">3</span></code> from <code class="docutils literal"><span class="pre">field[3]</span></code>.
But after the delete, there is a renumbering, so <code class="docutils literal"><span class="pre">field[3]</span></code> becomes
<code class="docutils literal"><span class="pre">field[2]`</span></code> before we subtract <code class="docutils literal"><span class="pre">3</span></code> from it, and that's why the
seventh argument is <code class="docutils literal"><span class="pre">2</span></code>, not <code class="docutils literal"><span class="pre">3</span></code>. Therefore, after this update,
<code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code>, <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">0</span></code>.</p>
<p>In the update:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">999</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">XYZ&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>we're making a long string so that splice will work in the next example.
Therefore, after this update, <code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code>, <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'XYZ'</span></code>.</p>
<p>In the update</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">update</span><span class="p">({</span><span class="mi">999</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">:&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">!!&#39;</span><span class="p">}})</span>
</pre></div>
</div>
<p>The third argument is <code class="docutils literal"><span class="pre">':'</span></code>, that is, this is the example of splice.
The fourth argument is <code class="docutils literal"><span class="pre">2</span></code> because the change will occur in <code class="docutils literal"><span class="pre">field[2]</span></code>.
The fifth argument is 2 because deletion will begin with the second byte.
The sixth argument is 1 because the number of bytes to delete is 1.
The seventh argument is <code class="docutils literal"><span class="pre">'!!'</span></code>, because <code class="docutils literal"><span class="pre">'!!'</span></code> is to be added at this position.
Therefore, after this update, <code class="docutils literal"><span class="pre">field[1]</span></code> = <code class="docutils literal"><span class="pre">999</span></code>, <code class="docutils literal"><span class="pre">field[2]</span></code> = <code class="docutils literal"><span class="pre">'X!!Z'</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.upsert">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">upsert</code><big>(</big><em>tuple_value</em>, <em>{{operator</em>, <em>field_no</em>, <em>value}</em>, <em>...}</em><big>)</big><a class="headerlink" href="#lua-function.space_object.upsert" title="Ссылка на это определение">¶</a></dt>
<dd><p>Update or insert a tuple.</p>
<p>If there is an existing tuple which matches the key fields of <code class="code docutils literal"><span class="pre">tuple_value</span></code>, then the
request has the same effect as <a class="reference internal" href="#lua-function.space_object.update" title="space_object.update"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:update()</span></code></a> and the
<code class="code docutils literal"><span class="pre">{{operator,</span> <span class="pre">field_no,</span> <span class="pre">value},</span> <span class="pre">...}</span></code> parameter is used.
If there is no existing tuple which matches the key fields of <code class="code docutils literal"><span class="pre">tuple_value</span></code>, then the
request has the same effect as <a class="reference internal" href="#lua-function.space_object.insert" title="space_object.insert"><code class="xref lua lua-func docutils literal"><span class="pre">space_object:insert()</span></code></a> and the
<code class="code docutils literal"><span class="pre">{tuple_value}</span></code> parameter is used. However, unlike <code class="code docutils literal"><span class="pre">insert</span></code> or
<code class="code docutils literal"><span class="pre">update</span></code>, <code class="code docutils literal"><span class="pre">upsert</span></code> will not read a tuple and perform
error checks before returning -- this is a design feature which
enhances throughput but requires more caution on the part of the user.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">tuple_value</span> (type = Lua table or scalar) =
field values, must be passed as a Lua
table if tuple_value contains more than one field;
<span class="ccodei">{operator, field_no, value}</span> (type = Lua table) = a group of arguments for each
operation, indicating what the operation is, what field the
operation will apply to, and what value will be applied. The
field number can be negative, meaning the position from the
end of tuple (#tuple + negative field number + 1).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">null.</td>
</tr>
</tbody>
</table>
<p>Possible errors: it is illegal to modify a primary-key field.</p>
<p><strong>Complexity factors:</strong> Index size, Index type, number of indexes accessed, WAL
settings.</p>
<p><strong>Example:</strong></p>
<blockquote>
<div><div class="highlight-lua"><div class="highlight"><pre><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">upsert</span><span class="p">({</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">c&#39;</span><span class="p">},</span> <span class="p">{{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">a&#39;</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;</span><span class="s">=&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">b&#39;</span><span class="p">}})</span>
</pre></div>
</div>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.delete">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">delete</code><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#lua-function.space_object.delete" title="Ссылка на это определение">¶</a></dt>
<dd><p>Delete a tuple identified by a primary key.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">key</span> (type = Lua table or scalar) = key to be matched against the index
key, which may be multi-part.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the deleted tuple</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p><strong>Complexity Factors:</strong> Index size, Index type</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">0</span><span class="p-Indicator">,</span> <span class="s">&#39;My</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">a&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">error</span><span class="p-Indicator">:</span> <span class="s">&#39;Supplied</span><span class="nv"> </span><span class="s">key</span><span class="nv"> </span><span class="s">type</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">part</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">does</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">match</span><span class="nv"> </span><span class="s">index</span><span class="nv"> </span><span class="s">part</span><span class="nv"> </span><span class="s">type:</span>
  <span class="s">expected</span><span class="nv"> </span><span class="s">NUM&#39;</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="lua-data.space_object.id">
<em class="property"> </em><code class="descclassname">space_object.</code><code class="descname">id</code><a class="headerlink" href="#lua-data.space_object.id" title="Ссылка на это определение">¶</a></dt>
<dd><p>Ordinal space number. Spaces can be referenced by either name or
number. Thus, if space <code class="docutils literal"><span class="pre">tester</span></code> has <code class="docutils literal"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">800</span></code>, then
<code class="docutils literal"><span class="pre">box.space.tester:insert{0}</span></code> and <code class="docutils literal"><span class="pre">box.space[800]:insert{0}</span></code>
are equivalent requests.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">id</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">512</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="lua-data.space_object.enabled">
<em class="property"> </em><code class="descclassname">space_object.</code><code class="descname">enabled</code><a class="headerlink" href="#lua-data.space_object.enabled" title="Ссылка на это определение">¶</a></dt>
<dd><p>Whether or not this space is enabled.
The value is <code class="docutils literal"><span class="pre">false</span></code> if the space has no index.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
</dd></dl>

<dl class="data">
<dt id="lua-data.space_object.field_count">
<em class="property"> </em><code class="descclassname">space_object.</code><code class="descname">field_count</code><a class="headerlink" href="#lua-data.space_object.field_count" title="Ссылка на это определение">¶</a></dt>
<dd><p>The required field count for all tuples in this space. The field_count
can be set initially with:</p>
<div class="highlight highlight-python"><div class="highlight"><pre>box.schema.space:create...
field_count = &lt;field_count_value&gt;
</pre></div>
</div>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">field_count</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">0</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>The default value is <code class="docutils literal"><span class="pre">0</span></code>, which means there is no required field count.</p>
</dd></dl>

<dl class="data">
<dt id="lua-data.space_object.index">
<em class="property"> </em><code class="descclassname">space_object.</code><code class="descname">index</code><a class="headerlink" href="#lua-data.space_object.index" title="Ссылка на это определение">¶</a></dt>
<dd><p>A container for all defined indexes. An index is a Lua object of type
<a class="reference internal" href="box_index.html#lua-module.box.index" title="box.index"><code class="xref lua lua-mod docutils literal"><span class="pre">box.index</span></code></a> with methods to search tuples and iterate over them in
predefined order.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Rtype:</th><td class="field-body">table</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-lua"><div class="highlight"><pre><span class="n">tarantool</span><span class="o">&gt;</span> <span class="o">#</span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">index</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="mi">1</span>
<span class="o">...</span>
<span class="n">tarantool</span><span class="o">&gt;</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">.</span><span class="n">type</span>
<span class="c1">---</span>
<span class="o">-</span> <span class="n">TREE</span>
<span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.len">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">len</code><big>(</big><big>)</big><a class="headerlink" href="#lua-function.space_object.len" title="Ссылка на это определение">¶</a></dt>
<dd><p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Number of tuples in the space.</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">len</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">2</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.truncate">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">truncate</code><big>(</big><big>)</big><a class="headerlink" href="#lua-function.space_object.truncate" title="Ссылка на это определение">¶</a></dt>
<dd><p>Deletes all tuples.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
<p><strong>Complexity Factors:</strong> Index size, Index type, Number of tuples accessed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">truncate</span><span class="p">()</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">len</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">0</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.inc">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">inc</code><big>{</big><em>field-value</em><span class="optional">[</span>, <em>field-value ...</em><span class="optional">]</span><big>}</big><a class="headerlink" href="#lua-function.space_object.inc" title="Ссылка на это определение">¶</a></dt>
<dd><p>Increments a counter in a tuple whose primary key matches the
field-value(s). The field following the primary-key fields
will be the counter. If there is no tuple matching the
<code class="docutils literal"><span class="pre">field-value(s)</span></code>, a new one is inserted with initial counter
value set to <code class="docutils literal"><span class="pre">1</span></code>.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">field-value(s)</span> (type = Lua table or scalar) = values which must match the primary key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the new counter value</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">number</td>
</tr>
</tbody>
</table>
<p><strong>Complexity Factors:</strong> Index size, Index type, WAL settings.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">forty_second_space&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">forty_second_space</span><span class="p">:</span><span class="n">inc</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">a&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">1</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">forty_second_space</span><span class="p">:</span><span class="n">inc</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">a&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">2</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.dec">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">dec</code><big>{</big><em>field-value</em><span class="optional">[</span>, <em>field-value ...</em><span class="optional">]</span><big>}</big><a class="headerlink" href="#lua-function.space_object.dec" title="Ссылка на это определение">¶</a></dt>
<dd><p>Decrements a counter in a tuple whose primary key matches the
<code class="docutils literal"><span class="pre">field-value(s)</span></code>. The field following the primary-key fields
will be the counter. If there is no tuple matching the
<code class="docutils literal"><span class="pre">field-value(s)</span></code>, a new one is not inserted. If the counter value drops
to zero, the tuple is deleted.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">field-value(s)</span> (type = Lua table or scalar) = values which must match the primary key.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the new counter value</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">number</td>
</tr>
</tbody>
</table>
<p><strong>Complexity factors:</strong> Index size, Index type, WAL settings.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space19&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space19</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">a&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;a&#39;</span><span class="p-Indicator">,</span> <span class="nv">1000</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">forty_second_space</span><span class="p">:</span><span class="n">dec</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">a&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">999</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">forty_second_space</span><span class="p">:</span><span class="n">inc</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">a&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">998</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.auto_increment">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">auto_increment</code><big>{</big><em>field-value</em><span class="optional">[</span>, <em>field-value ...</em><span class="optional">]</span><big>}</big><a class="headerlink" href="#lua-function.space_object.auto_increment" title="Ссылка на это определение">¶</a></dt>
<dd><p>Insert a new tuple using an auto-increment primary key. The space specified
by space_object must have a <code class="docutils literal"><span class="pre">NUM</span></code> primary key index of type <code class="docutils literal"><span class="pre">TREE</span></code>. The
primary-key field will be incremented before the insert.
This is only applicable for the memtx storage engine.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;
<span class="ccodei">field-value(s)</span> (type = Lua table or scalar) = tuple's fields, other than the primary-key field.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the inserted tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p><strong>Complexity Factors:</strong> Index size, Index type,
Number of indexes accessed, WAL settings.</p>
<p>Possible errors: index has wrong type or primary-key indexed field is not a number.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">auto_increment</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">Fld#1&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Fld#2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;Fld#1&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;Fld#2&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">auto_increment</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">Fld#3&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">2</span><span class="p-Indicator">,</span> <span class="s">&#39;Fld#3&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.space_object.pairs">
<em class="property"> </em><code class="descclassname">space_object:</code><code class="descname">pairs</code><big>(</big><big>)</big><a class="headerlink" href="#lua-function.space_object.pairs" title="Ссылка на это определение">¶</a></dt>
<dd><p>A helper function to prepare for iterating over all tuples in a space.</p>
<p>Parameters: <code class="samp docutils literal"><em><span class="pre">space_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">function which can be used in a for/end loop. Within the loop, a value is returned for each iteration.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">function, tuple</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space33&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="c1">-- index &#39;X&#39; has default parts {1, &#39;NUM&#39;}</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">X&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Hello my &#39;</span><span class="p">},</span> <span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Lua world&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">0</span><span class="p-Indicator">,</span> <span class="s">&#39;Hello</span><span class="nv"> </span><span class="s">my</span><span class="nv"> </span><span class="s">&#39;</span><span class="p-Indicator">]</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;Lua</span><span class="nv"> </span><span class="s">world&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">&#39;</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">s</span><span class="p">:</span><span class="nb">pairs</span><span class="p">()</span> <span class="k">do</span>
<span class="gp">         &gt; </span>  <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">..</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">         &gt; </span><span class="k">end</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">tmp</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Hello my Lua world</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="lua-data.box.space._schema">
<em class="property"> </em><code class="descclassname">box.space.</code><code class="descname">_schema</code><a class="headerlink" href="#lua-data.box.space._schema" title="Ссылка на это определение">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">_schema</span></code> is a system tuple set. Its single tuple contains these fields:
<code class="docutils literal"><span class="pre">'version',</span> <span class="pre">major-version-number,</span> <span class="pre">minor-version-number</span></code>.</p>
<p><strong>Example:</strong></p>
<p>The following function will display all fields in all tuples of <code class="docutils literal"><span class="pre">_schema</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="k">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">ta</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_schema</span><span class="p">:</span><span class="nb">pairs</span><span class="p">()</span> <span class="k">do</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">&#39;</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="o">#</span><span class="n">v</span> <span class="k">do</span>
      <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">..</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">..</span> <span class="s1">&#39;</span><span class="s"> &#39;</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">end</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">return</span> <span class="n">ta</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Here is what <code class="docutils literal"><span class="pre">example()</span></code> returns in a typical installation:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">example</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="s">&#39;cluster</span><span class="nv"> </span><span class="s">1ec4e1f8-8f1b-4304-bb22-6c47ce0cf9c6</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;max_id</span><span class="nv"> </span><span class="s">520</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;version</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">6</span><span class="nv"> </span><span class="s">&#39;</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="lua-data.box.space._space">
<em class="property"> </em><code class="descclassname">box.space.</code><code class="descname">_space</code><a class="headerlink" href="#lua-data.box.space._space" title="Ссылка на это определение">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">_space</span></code> is a system tuple set. Its tuples contain these fields: <code class="docutils literal"><span class="pre">id</span></code>,
<code class="docutils literal"><span class="pre">uid</span></code>, <code class="docutils literal"><span class="pre">space-name</span></code>, <code class="docutils literal"><span class="pre">engine</span></code>, <code class="docutils literal"><span class="pre">field_count</span></code>, <code class="docutils literal"><span class="pre">temporary</span></code>, <code class="docutils literal"><span class="pre">format</span></code>.
These fields are established by <a class="reference internal" href="box_schema.html#lua-function.box.schema.space.create" title="box.schema.space.create"><code class="xref lua lua-func docutils literal"><span class="pre">space.create()</span></code></a>.</p>
<p><strong>Example:</strong></p>
<p>The following function will display all simple fields in all tuples of <code class="docutils literal"><span class="pre">_space</span></code>.</p>
<div class="highlight-lua_tarantool"><div class="highlight"><pre><span class="k">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">ta</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">:</span><span class="nb">pairs</span><span class="p">()</span> <span class="k">do</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">&#39;</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="o">#</span><span class="n">v</span> <span class="k">do</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">table&#39;</span> <span class="k">then</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">..</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">..</span> <span class="s1">&#39;</span><span class="s"> &#39;</span>
      <span class="k">end</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">end</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">return</span> <span class="n">ta</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Here is what <code class="docutils literal"><span class="pre">example()</span></code> returns in a typical installation:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">example</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="s">&#39;272</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">_schema</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;280</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">_space</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;288</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">_index</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;296</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">_func</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;304</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">_user</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;312</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">_priv</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;320</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">_cluster</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;512</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">tester</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;513</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">origin</span><span class="nv"> </span><span class="s">sophia</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;514</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">archive</span><span class="nv"> </span><span class="s">memtx</span><span class="nv"> </span><span class="s">0</span><span class="nv">  </span><span class="s">&#39;</span>
<span class="nn">...</span>
</pre></div>
</div>
<p><strong>Example:</strong></p>
<p>The following requests will create a space using
<code class="code docutils literal"><span class="pre">box.schema.space.create</span></code> with a <code class="code docutils literal"><span class="pre">format</span></code> clause.
Then it retrieves the _space tuple for the new space.
This illustrates the typical use of the <code class="code docutils literal"><span class="pre">format</span></code> clause,
it shows the recommended names and data types for the fields.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">TM&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">format</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">         &gt; </span>    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{[</span><span class="s2">&quot;</span><span class="s">name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">field#1&quot;</span><span class="p">},</span>
<span class="gp">         &gt; </span>    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{[</span><span class="s2">&quot;</span><span class="s">type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">num&quot;</span><span class="p">}</span>
<span class="gp">         &gt; </span>  <span class="p">}</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">index</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
  <span class="l-Scalar-Plain">on_replace</span><span class="p-Indicator">:</span> <span class="s">&#39;function:</span><span class="nv"> </span><span class="s">0x41c67338&#39;</span>
  <span class="l-Scalar-Plain">temporary</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
  <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">522</span>
  <span class="l-Scalar-Plain">engine</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">memtx</span>
  <span class="l-Scalar-Plain">enabled</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">TM</span>
  <span class="l-Scalar-Plain">field_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">created</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mi">522</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">522</span><span class="p-Indicator">,</span> <span class="nv">1</span><span class="p-Indicator">,</span> <span class="s">&#39;TM&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;memtx&#39;</span><span class="p-Indicator">,</span> <span class="nv">0</span><span class="p-Indicator">,</span> <span class="s">&#39;&#39;</span><span class="p-Indicator">,</span> <span class="p-Indicator">[{</span><span class="s">&#39;name&#39;</span><span class="p-Indicator">:</span> <span class="s">&#39;field#1&#39;</span><span class="p-Indicator">},</span> <span class="p-Indicator">{</span><span class="s">&#39;type&#39;</span><span class="p-Indicator">:</span> <span class="s">&#39;num&#39;</span><span class="p-Indicator">}]]</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="lua-data.box.space._index">
<em class="property"> </em><code class="descclassname">box.space.</code><code class="descname">_index</code><a class="headerlink" href="#lua-data.box.space._index" title="Ссылка на это определение">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">_index</span></code> is a system tuple set. Its tuples contain these fields:
<code class="docutils literal"><span class="pre">space-id</span> <span class="pre">index-id</span> <span class="pre">index-name</span> <span class="pre">index-type</span> <span class="pre">index-is-unique</span>
<span class="pre">index-field-count</span> <span class="pre">[tuple-field-no,</span> <span class="pre">tuple-field-type</span> <span class="pre">...]</span></code>.</p>
<p>The following function will display some fields in all tuples of <code class="docutils literal"><span class="pre">_index</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="k">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">ta</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_index</span><span class="p">:</span><span class="nb">pairs</span><span class="p">()</span> <span class="k">do</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">&#39;</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="k">do</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">..</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">..</span> <span class="s1">&#39;</span><span class="s"> &#39;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">end</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">return</span> <span class="n">ta</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Here is what <code class="docutils literal"><span class="pre">example()</span></code> returns in a typical installation:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">example</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="s">&#39;272</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;280</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;280</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">owner</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;280</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;288</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;288</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;296</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;296</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">owner</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;296</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;304</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;304</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">owner</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;304</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">name</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;312</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;312</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">owner</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;312</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">object</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;320</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;320</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">uuid</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">str</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;512</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">primary</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">num</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;513</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">NUM</span><span class="nv"> </span><span class="s">&#39;</span>
  <span class="p-Indicator">-</span> <span class="s">&#39;514</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tree</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">0</span><span class="nv"> </span><span class="s">STR</span><span class="nv"> </span><span class="s">&#39;</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="data">
<dt id="lua-data.box.space._user">
<em class="property"> </em><code class="descclassname">box.space.</code><code class="descname">_user</code><a class="headerlink" href="#lua-data.box.space._user" title="Ссылка на это определение">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">_user</span></code> is a new system tuple set for
support of the <a class="reference internal" href="authentication.html#box-authentication"><span>authorization feature</span></a>.</p>
</dd></dl>

<dl class="data">
<dt id="lua-data.box.space._priv">
<em class="property"> </em><code class="descclassname">box.space.</code><code class="descname">_priv</code><a class="headerlink" href="#lua-data.box.space._priv" title="Ссылка на это определение">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">_priv</span></code> is a new system tuple set for
support of the <a class="reference internal" href="authentication.html#box-authentication"><span>authorization feature</span></a>.</p>
</dd></dl>

<dl class="data">
<dt id="lua-data.box.space._cluster">
<em class="property"> </em><code class="descclassname">box.space.</code><code class="descname">_cluster</code><a class="headerlink" href="#lua-data.box.space._cluster" title="Ссылка на это определение">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">_cluster</span></code> is a new system tuple set
for support of the <a class="reference internal" href="../replication/index.html#box-replication"><span>replication feature</span></a>.</p>
</dd></dl>

<div class="section" id="example-showing-use-of-the-box-space-functions">
<h2>3.4.2.1. Example showing use of the box.space functions<a class="headerlink" href="#example-showing-use-of-the-box-space-functions" title="Ссылка на этот заголовок">¶</a></h2>
<p>This function will illustrate how to look at all the spaces, and for each
display: approximately how many tuples it contains, and the first field of
its first tuple. The function uses Tarantool <code class="docutils literal"><span class="pre">box.space</span></code> functions <code class="docutils literal"><span class="pre">len()</span></code>
and <code class="docutils literal"><span class="pre">pairs()</span></code>. The iteration through the spaces is coded as a scan of the
<code class="docutils literal"><span class="pre">_space</span></code> system tuple set, which contains metadata. The third field in
<code class="docutils literal"><span class="pre">_space</span></code> contains the space name, so the key instruction
<code class="docutils literal"><span class="pre">space_name</span> <span class="pre">=</span> <span class="pre">v[3]</span></code> means <code class="docutils literal"><span class="pre">space_name</span></code> is the <code class="docutils literal"><span class="pre">space_name</span></code> field in
the tuple of <code class="docutils literal"><span class="pre">_space</span></code> that we've just fetched with <code class="docutils literal"><span class="pre">pairs()</span></code>. The function
returns a table:</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="k">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">tuple_count</span><span class="p">,</span> <span class="n">space_name</span><span class="p">,</span> <span class="n">line</span>
  <span class="kd">local</span> <span class="n">ta</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="k">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_space</span><span class="p">:</span><span class="nb">pairs</span><span class="p">()</span> <span class="k">do</span>
    <span class="n">space_name</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">[</span><span class="n">space_name</span><span class="p">].</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
      <span class="n">tuple_count</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">1 or more&#39;</span>
    <span class="k">else</span>
      <span class="n">tuple_count</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">0&#39;</span>
    <span class="k">end</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">space_name</span> <span class="o">..</span> <span class="s1">&#39;</span><span class="s"> tuple_count =&#39;</span> <span class="o">..</span> <span class="n">tuple_count</span>
    <span class="k">if</span> <span class="n">tuple_count</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">1 or more&#39;</span> <span class="k">then</span>
      <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">v1</span> <span class="k">in</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">[</span><span class="n">space_name</span><span class="p">]:</span><span class="nb">pairs</span><span class="p">()</span> <span class="k">do</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">..</span> <span class="s1">&#39;</span><span class="s">. first field in first tuple = &#39;</span> <span class="o">..</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">break</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">return</span> <span class="n">ta</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And here is what happens when one invokes the function:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">example</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_schema tuple_count =1 or more. first field in first tuple = cluster</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_space tuple_count =1 or more. first field in first tuple = 272</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_vspace tuple_count =1 or more. first field in first tuple = 272</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_index tuple_count =1 or more. first field in first tuple = 272</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_vindex tuple_count =1 or more. first field in first tuple = 272</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_func tuple_count =1 or more. first field in first tuple = 1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_vfunc tuple_count =1 or more. first field in first tuple = 1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_user tuple_count =1 or more. first field in first tuple = 0</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_vuser tuple_count =1 or more. first field in first tuple = 0</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_priv tuple_count =1 or more. first field in first tuple = 1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_vpriv tuple_count =1 or more. first field in first tuple = 1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">_cluster tuple_count =1 or more. first field in first tuple = 1</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>


        </article>


<div class="b-page_over-tail">

    
    <a href="box_schema.html" class="b-prev">3.4.1. Package <cite>box.schema</cite></a>
    
    
    <a href="box_index.html" class="b-next">3.4.3. Package <cite>box.index</cite></a>
    
</div>


      </div>
    </div>
  </div>
  

      </div>
    </div>

    <!-- FOOTER > -->
    <footer class="b-footer">
      <div class="b-footer-wrapper">
        <nav class="b-footer_menu">
          
  <ul class="b-menu">
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org" class="b-menu-item-url">Overview</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/doc/" class="b-menu-item-url p-active">Documentation</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/download.html" class="b-menu-item-url">Download</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/careers.html" class="b-menu-item-url">Careers</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
        
      </li>
    
  </ul>

          <div class="b-footer-other">
            <a href="http://stable.tarantool.org">1.5 web site and downloads</a>
          </div>
        </nav>
      </div>
    </footer>
  <!-- < FOOTER -->
  </body>
</html>

