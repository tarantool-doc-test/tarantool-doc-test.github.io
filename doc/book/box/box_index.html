




<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>3.4.3. Package box.index</title>
    <link rel="shortcut icon" href="/theme/favicon.ico" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.6.7-521-g0d75d50',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <script type="text/javascript" src="../../_static/jquery.pin.min.js"></script>
    <script type="text/javascript" src="../../_static/headers.js"></script>
    <link rel="stylesheet" href="/theme/design.css">
    <link rel="stylesheet" href="/theme/pygmentize.css">
    <link rel="stylesheet" href="../../_static/sphinx_design.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
     
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


  </head>
  
  <body class="p-cols_design">
  
    <div class="b-wrapper">
      <!-- HEADER > -->
      <header class="b-header">
        <div class="b-header-wrapper">
          <nav class="b-header_menu">
            
  <ul class="b-menu">
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org" class="b-menu-item-url">Overview</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/doc/" class="b-menu-item-url p-active">Documentation</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/download.html" class="b-menu-item-url">Download</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/careers.html" class="b-menu-item-url">Careers</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
        
      </li>
    
  </ul>

          </nav>
        </div>
      </header>
      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  
  <section class="b-lightgray_block b-documentation_top b-clearbox p-documentation_in">
  
    <div class="b-block-wrapper">
      <h2 class="b-section-title">3.4.3. Package <cite>box.index</cite></h2>
      
    </div>
  </section>
  <div class="b-cols_content b-clearbox">
    <div class="b-cols_content_left">
      
      
<form id="searchbox" role="search" class="search b-search" action="../../search.html" method="get">
  <input class="b-search-text" name="q" type="text"/ placeholder="Search the manual">
  <input class="b-search-but" type="submit" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>


      
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../reference/index.html">Reference Manual</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../reference/box.html">Package <cite>box</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/box_error.html">Package <cite>box.error</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/clock.html">Package <cite>clock</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/console.html">Package <cite>console</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/csv.html">Package <cite>csv</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/digest.html">Package <cite>digest</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/expirationd.html">Package <cite>expirationd</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fiber.html">Package <cite>fiber</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fiber-ipc.html">Package <cite>fiber-ipc</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fio.html">Package <cite>fio</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/fun.html">Package <cite>fun</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/jit.html">Package <cite>jit</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/json.html">Package <cite>json</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/log.html">Package <cite>log</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/msgpack.html">Package <cite>msgpack</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/net_box.html">Package <cite>net.box</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/pickle.html">Package <cite>pickle</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/shard.html">Package <cite>shard</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/socket.html">Package <cite>socket</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/strict.html">Package <cite>strict</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/tap.html">Package <cite>tap</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/tarantool.html">Package <cite>tarantool</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/uuid.html">Package <cite>uuid</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/yaml.html">Package <cite>yaml</cite></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/other.html">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/capi.html">Module C API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dev_guide/index.html">Contributing</a></li>
</ul>

    </div>
    <div class="b-cols_content_right">
      <div class="b-cols_content_right-slot">
  

<div class="b-page_header">
  <ul class="b-path-list">
    <li class="b-path-list-item">
      <a href="/doc/" class="b-path-list-item-url">Documentation</a>
    </li>
  
    <li class="b-path-list-item">
      <a href="../../reference/index.html" class="b-path-list-item-url">Reference Manual</a>
    </li>
  
    <li class="b-path-list-item">
      <a href="../../reference/box.html" class="b-path-list-item-url">Package <cite>box</cite></a>
    </li>
  
    <li class="b-path-list-item"><span class="b-path_current">3.4.3. Package <cite>box.index</cite></span></li>
  </ul>
</div>

<article class="b-article">
          
          
  <div class="section" id="package-box-index">
<h1>3.4.3. Package <cite>box.index</cite><a class="headerlink" href="#package-box-index" title="Ссылка на этот заголовок">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">box.index</span></code> package provides read-only access for index definitions and
index keys. Indexes are contained in <code class="samp docutils literal"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">.index</span></code> array within
each space object. They provide an API for ordered iteration over tuples. This
API is a direct binding to corresponding methods of index objects of type
<code class="docutils literal"><span class="pre">box.index</span></code> in the storage engine.</p>
<span class="target" id="lua-module.box.index"></span><dl class="class">
<dt id="lua-object.box.index.index_object">
<em class="property">object </em><code class="descname">index_object</code><a class="headerlink" href="#lua-object.box.index.index_object" title="Ссылка на это определение">¶</a></dt>
<dd><dl class="data">
<dt id="lua-data.index_object.unique">
<em class="property"> </em><code class="descclassname">index_object.</code><code class="descname">unique</code><a class="headerlink" href="#lua-data.index_object.unique" title="Ссылка на это определение">¶</a></dt>
<dd><p>True if the index is unique, false if the index is not unique.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Rtype:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="data">
<dt id="lua-data.index_object.type">
<em class="property"> </em><code class="descclassname">index_object.</code><code class="descname">type</code><a class="headerlink" href="#lua-data.index_object.type" title="Ссылка на это определение">¶</a></dt>
<dd><p>Index type, 'TREE' or 'HASH' or 'BITSET' or 'RTREE'.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Rtype:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="data">
<dt id="lua-data.index_object.parts">
<em class="property"> </em><code class="descclassname">index_object.</code><code class="descname">parts</code><a class="headerlink" href="#lua-data.index_object.parts" title="Ссылка на это определение">¶</a></dt>
<dd><p>An array describing index key fields.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Rtype:</th><td class="field-body">table</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">unique</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
  <span class="l-Scalar-Plain">parts</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">NUM</span>
    <span class="l-Scalar-Plain">fieldno</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">1</span>
  <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0</span>
  <span class="l-Scalar-Plain">space_id</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">513</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">primary</span>
  <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">TREE</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.pairs">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">pairs</code><big>(</big><em>bitset-value | field-value...</em>, <em>iterator-type</em><big>)</big><a class="headerlink" href="#lua-function.index_object.pairs" title="Ссылка на это определение">¶</a></dt>
<dd><p>This method provides iteration support within an index. Parameter type is
used to identify the semantics of iteration. Different index types support
different iterators. The remaining arguments of the function are varying
and depend on the iteration type. For example, a TREE index maintains a
strict order of keys and can return all tuples in ascending or descending
order, starting from the specified key. Other index types, however, do not
support ordering.</p>
<p>To understand consistency of tuples returned by an iterator, it's essential
to know the principles of the Tarantool transaction processing subsystem. An
iterator in Tarantool does not own a consistent read view. Instead, each
procedure is granted exclusive access to all tuples and spaces until it
encounters a &quot;context switch&quot;: by causing a write to disk, network, or by an
explicit call to <a class="reference internal" href="../../reference/fiber.html#lua-function.fiber.yield" title="fiber.yield"><code class="xref lua lua-func docutils literal"><span class="pre">fiber.yield()</span></code></a>. When the execution flow returns
to the yielded procedure, the data set could have changed significantly.
Iteration, resumed after a yield point, does not preserve the read view,
but continues with the new content of the database.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><em><span class="pre">iterator-type</span></em></code> = iteration strategy as defined in tables below.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">this method returns an iterator closure, i.e. a function which can
be used to get the next value on each invocation</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">function, tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: Selected iteration type is not supported in the subject index type,
or supplied parameters do not match iteration type.</p>
<p>Complexity Factors: Index size, Index type, Number of tuples accessed.</p>
<div class="table container">
<p><strong>TREE iterator types</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="15%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>box.index.ALL
or 'ALL'</td>
<td>none</td>
<td>Iterate over all tuples in an index. Tuples
are returned  in ascending order by key.</td>
</tr>
<tr class="row-odd"><td>box.index.EQ
or 'EQ'</td>
<td>field
values</td>
<td><p class="first">Equality iterator: iterate over all tuples
where field values = key values. Parts of a
multi-part key need to be separated by
commas.</p>
<p>If the number of field values is less than
the number of parts of a multi-part key,
the missing field values are considered to
be matching.</p>
<p class="last">If there are multiple matches, then tuples
are returned in ascending order by key.</p>
</td>
</tr>
<tr class="row-even"><td>box.index.GT
or 'GT'</td>
<td>field
values</td>
<td>Keys match if key values are greater than
field values. If the number of field values
is less than the number of parts of a
multi-part key, the missing field values
are considered to be matching. If the field
value is <code class="docutils literal"><span class="pre">nil</span></code>, iteration starts from the
smallest key in the index. Tuples are
returned in ascending order by key.</td>
</tr>
<tr class="row-odd"><td>box.index.REQ
or 'REQ'</td>
<td>field
values</td>
<td>Reverse equality iterator. Matching is
determined in the same way as for
<code class="docutils literal"><span class="pre">box.index.EQ</span></code>, but, if there are multiple
matches, then tuples are returned in
descending order by key,</td>
</tr>
<tr class="row-even"><td>box.index.GE
or 'GE'</td>
<td>field
values</td>
<td>Keys match if key values are greater than
or equal to field values. Tuples are
returned in ascending order by key. If the
field value is <code class="docutils literal"><span class="pre">nil</span></code>, iteration starts
from the first key in the index.</td>
</tr>
<tr class="row-odd"><td>box.index.LT
or 'LT'</td>
<td>field
values</td>
<td>Keys match if key values are less than
field values. Tuples are returned in
descending order by key. If the field value
is <code class="docutils literal"><span class="pre">nil</span></code>, iteration starts from the last
key in the index.</td>
</tr>
<tr class="row-even"><td>box.index.LE
or 'LE'</td>
<td>field
values</td>
<td>Keys match if key values are less than or
equal to field values. Tuples are returned
in descending order by key. If the field
value is <code class="docutils literal"><span class="pre">nil</span></code>, iteration starts from
the last key in the index.</td>
</tr>
</tbody>
</table>
<p><strong>HASH iterator types</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="15%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>box.index.ALL
or 'ALL'</td>
<td>none</td>
<td>Iterate over all tuples in an index. Tuples
are returned in ascending order of the key.</td>
</tr>
<tr class="row-odd"><td>box.index.EQ
or 'EQ'</td>
<td>field
values</td>
<td><p class="first">Equality iterator: iterate over all tuples
matching the key. Parts of a multi-part
key need to be separated by commas.</p>
<p>A HASH index only supports exact match:
all parts of a key participating in the
index must be provided.</p>
<p class="last">HASH indexes are always unique.</p>
</td>
</tr>
<tr class="row-even"><td>box.index.GT
or 'GT'</td>
<td>field
values</td>
<td>Keys match if hashed key values are greater
than hashed field values. If the number of
field values is less than the number of
parts of a multi-part key, the result is an
error. Tuples are returned in ascending
order by hashed key, so the order will
appear to be random. Provided that the
space is not being updated, the 'GT'
iterator can be used to retrieve all
tuples piece by piece, by supplying the
last returned value from the previous
range as the start field value for an
iterator over the next range.</td>
</tr>
</tbody>
</table>
<p><strong>BITSET iterator types</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="13%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>box.index.ALL
or 'ALL'</td>
<td>none</td>
<td>Iterate over all tuples in an index. Tuples
are returned in ascending order of the
key's bitset, and so will appear to be
unordered.</td>
</tr>
<tr class="row-odd"><td>box.index.EQ
or 'EQ'</td>
<td>field
values</td>
<td>Equality iterator: iterate over all tuples
matching the field values. If there are
multiple field values, they need to be
separated by commas.</td>
</tr>
<tr class="row-even"><td>box.index.BITS_ALL_SET</td>
<td>field
values</td>
<td>Keys match if all of the bits specified in
'bit mask' are set.</td>
</tr>
<tr class="row-odd"><td>box.index.BITS_ANY_SET</td>
<td>field
values</td>
<td>Keys match if any of the bits specified in
'bit mask' is set.</td>
</tr>
<tr class="row-even"><td>box.index.BITS_ALL_NOT_SET</td>
<td>field
values</td>
<td>Keys match if none of the bits specified in
'bit mask' is set.</td>
</tr>
</tbody>
</table>
<p id="rtree-iterator"><strong>RTREE iterator types</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="13%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Arguments</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>box.index.ALL
or 'ALL'</td>
<td>none</td>
<td>All keys match. Tuples are returned in
ascending order of the primary key.</td>
</tr>
<tr class="row-odd"><td>box.index.EQ
or 'EQ'</td>
<td>field
values</td>
<td>Keys match if the rectangle-or-box defined by the
field values is the same as the rectangle-or-box
defined by the key -- where &quot;key&quot; means
&quot;the key in the RTREE index&quot; and
&quot;rectangle-or-box&quot; means &quot;rectangle-or-box as
explained in section <a class="reference internal" href="#rtree">RTREE</a>&quot;.</td>
</tr>
<tr class="row-even"><td>box.index.GT
or 'GT'</td>
<td>field
values</td>
<td>Keys match if all points of the rectangle-or-box
defined by the field values are within the
rectangle-or-box defined by the key.</td>
</tr>
<tr class="row-odd"><td>box.index.GE
or 'GE'</td>
<td>field
values</td>
<td>Keys match if all points of the rectangle-or-box
defined by the field values are within, or
at the side of, the rectangle-or-box defined by
the key.</td>
</tr>
<tr class="row-even"><td>box.index.LT
or 'LT'</td>
<td>field
values</td>
<td>Keys match if all points of the rectangle-or-box
defined by the key are within the rectangle-or-box
defined by the field values.</td>
</tr>
<tr class="row-odd"><td>box.index.LE
or 'LE'</td>
<td>field
values</td>
<td>Keys match if all points of the rectangle-or-box
defined by the key are within, or at the
side of, the rectangle-or-box defined by the field
values.</td>
</tr>
<tr class="row-even"><td>box.index.OVERLAPS
or 'OVERLAPS'</td>
<td>field
values</td>
<td>Keys match if all points of the rectangle-or-box
defined by the key are within, or at the
side of, the rectangle-or-box defined by the field
values.</td>
</tr>
<tr class="row-odd"><td>box.index.NEIGHBOR
or 'NEIGHBOR'</td>
<td>field
values</td>
<td>Keys match if all points of the rectangle-or-box
defined by the key are within, or at the
side of, the rectangle-or-box defined by the field
values.</td>
</tr>
</tbody>
</table>
</div>
<p><strong>Example:</strong></p>
<p>Default 'TREE' Index and <code class="docutils literal"><span class="pre">pairs()</span></code> function:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space17&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span><span class="p">}</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">C&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">C&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;C&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;C&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">B&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">A&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;B&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;A&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">C&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">!&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;C&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;!&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">A&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">C&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;A&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;C&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="k">function</span> <span class="nf">example</span><span class="p">()</span>
<span class="gp">         &gt; </span>  <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tuple</span> <span class="k">in</span>
<span class="gp">         &gt; </span>    <span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="nb">pairs</span><span class="p">(</span><span class="kc">nil</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>        <span class="n">iterator</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">ALL</span><span class="p">})</span> <span class="k">do</span>
<span class="gp">         &gt; </span>      <span class="nb">print</span><span class="p">(</span><span class="n">tuple</span><span class="p">)</span>
<span class="gp">         &gt; </span>  <span class="k">end</span>
<span class="gp">         &gt; </span><span class="k">end</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">example</span><span class="p">()</span>
<span class="go">[&#39;A&#39;, &#39;C&#39;]</span>
<span class="go">[&#39;B&#39;, &#39;A&#39;]</span>
<span class="go">[&#39;C&#39;, &#39;!&#39;]</span>
<span class="go">[&#39;C&#39;, &#39;C&#39;]</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">drop</span><span class="p">()</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="index-object-select"></span><dl class="method">
<dt id="lua-function.index_object.select">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">select</code><big>(</big><em>key</em>, <em>options</em><big>)</big><a class="headerlink" href="#lua-function.index_object.select" title="Ссылка на это определение">¶</a></dt>
<dd><p>This is an alternative to <a class="reference internal" href="box_space.html#lua-function.space_object.select" title="space_object.select"><code class="xref lua lua-func docutils literal"><span class="pre">box.space...select()</span></code></a>
which goes via a particular index and can make use of additional
parameters that specify the iterator type, and the limit (that is, the
maximum number of tuples to return) and the offset (that is, which
tuple to start with in the list).</p>
<p>Parameters:</p>
<ul>
<li><p class="first"><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</p>
</li>
<li><p class="first"><code class="samp docutils literal"><span class="pre">field-value(s)</span></code> = values to be matched against the index key;</p>
</li>
<li><dl class="first docutils">
<dt><code class="samp docutils literal"><span class="pre">option(s)</span></code> any or all of</dt>
<dd><ul class="first last simple">
<li><code class="samp docutils literal"><span class="pre">iterator</span> <span class="pre">=</span> <em><span class="pre">iterator-type</span></em></code>,</li>
<li><code class="samp docutils literal"><span class="pre">limit</span> <span class="pre">=</span> <em><span class="pre">maximum-number-of-tuples</span></em></code>,</li>
<li><code class="samp docutils literal"><span class="pre">offset</span> <span class="pre">=</span> <em><span class="pre">start-tuple-number</span></em></code>.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the tuple or tuples that match the field values.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple set as a Lua table</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="go">-- Create a space named tester.</span>
<span class="gp">tarantool&gt; </span><span class="n">sp</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="go">-- Create a unique index &#39;primary&#39;</span>
<span class="go">-- which won&#39;t be needed for this example.</span>
<span class="gp">tarantool&gt; </span><span class="n">sp</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span> <span class="p">}})</span>
<span class="go">-- Create a non-unique index &#39;secondary&#39;</span>
<span class="go">-- with an index on the second field.</span>
<span class="gp">tarantool&gt; </span><span class="n">sp</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">secondary&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">tree&#39;</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span><span class="p">}</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="go">-- Insert three tuples, values in field[2]</span>
<span class="go">-- equal to &#39;X&#39;, &#39;Y&#39;, and &#39;Z&#39;.</span>
<span class="gp">tarantool&gt; </span><span class="n">sp</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">X&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Row with field[2]=X&#39;</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">sp</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Y&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Row with field[2]=Y&#39;</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">sp</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Z&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Row with field[2]=Z&#39;</span><span class="p">}</span>
<span class="go">-- Select all tuples where the secondary index</span>
<span class="go">-- keys are greater than &#39;X&#39;.`</span>
<span class="gp">tarantool&gt; </span><span class="n">sp</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">secondary</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="s1">&#39;</span><span class="s">X&#39;</span><span class="p">},</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GT&#39;</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">limit</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="gp">         &gt; </span><span class="p">})</span>
</pre></div>
</div>
<p>The result will be a table of tuple and will look like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">2</span><span class="p-Indicator">,</span> <span class="s">&#39;Y&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;Row</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">field[2]=Y&#39;</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">3</span><span class="p-Indicator">,</span> <span class="s">&#39;Z&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;Row</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">field[2]=Z&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><code class="samp docutils literal"><span class="pre">index.</span><em><span class="pre">index-name</span></em></code> is optional. If it is omitted, then the assumed
index is the first (primary-key) index. Therefore, for the example
above, <code class="docutils literal"><span class="pre">box.space.tester:select({1},</span> <span class="pre">{iterator</span> <span class="pre">=</span> <span class="pre">'GT'})</span></code> would have
returned the same two rows, via the 'primary' index.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><code class="samp docutils literal"><span class="pre">iterator</span> <span class="pre">=</span> <em><span class="pre">iterator-type</span></em></code> is optional. If it is omitted, then
<code class="docutils literal"><span class="pre">iterator</span> <span class="pre">=</span> <span class="pre">'EQ'</span></code> is assumed.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><code class="samp docutils literal"><em><span class="pre">field-value</span></em> <span class="pre">[,</span> <em><span class="pre">field-value</span> <span class="pre">...</span></em><span class="pre">]</span></code> is optional. If it is omitted,
then every key in the index is considered to be a match, regardless of
iterator type. Therefore, for the example above,
<code class="docutils literal"><span class="pre">box.space.tester:select{}</span></code> will select every tuple in the tester
space via the first (primary-key) index.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last"><code class="samp docutils literal"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">.index.</span><em><span class="pre">index-name</span></em><span class="pre">:select(...)[1]`</span></code>. can be
replaced by <code class="samp docutils literal"><span class="pre">box.space.</span><em><span class="pre">space-name</span></em><span class="pre">.index.</span><em><span class="pre">index-name</span></em><span class="pre">:get(...)</span></code>.
That is, <code class="docutils literal"><span class="pre">get</span></code> can be used as a convenient shorthand to get the first
tuple in the tuple set that would be returned by <code class="docutils literal"><span class="pre">select</span></code>. However,
if there is more than one tuple in the tuple set, then <code class="docutils literal"><span class="pre">get</span></code> returns
an error.</p>
</div>
<p><strong>Example with BITSET index:</strong></p>
<p>The following script shows creation and search with a BITSET index.
Notice: BITSET cannot be unique, so first a primary-key index is created.
Notice: bit values are entered as hexadecimal literals for easier reading.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space_with_bitset&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary_index&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">STR&#39;</span><span class="p">},</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">TREE&#39;</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">bitset_index&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">},</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">BITSET&#39;</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">Tuple with bit value = 01&#39;</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">Tuple with bit value = 10&#39;</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="s1">&#39;</span><span class="s">Tuple with bit value = 11&#39;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">bitset_index</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">iterator</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">EQ</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">bit</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">10&#39;</span><span class="p-Indicator">,</span> <span class="nv">2</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">bitset_index</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">iterator</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">BITS_ANY_SET</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">bit</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">10&#39;</span><span class="p-Indicator">,</span> <span class="nv">2</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">bit</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">11&#39;</span><span class="p-Indicator">,</span> <span class="nv">3</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">bitset_index</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">iterator</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">BITS_ALL_SET</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">bit</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">10&#39;</span><span class="p-Indicator">,</span> <span class="nv">2</span><span class="p-Indicator">]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">bit</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">11&#39;</span><span class="p-Indicator">,</span> <span class="nv">3</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">bitset_index</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">iterator</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">BITS_ALL_NOT_SET</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">bit</span><span class="nv"> </span><span class="s">value</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">01&#39;</span><span class="p-Indicator">,</span> <span class="nv">1</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.min">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">min</code><big>(</big><span class="optional">[</span><em>key-value</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#lua-function.index_object.min" title="Ссылка на это определение">¶</a></dt>
<dd><p>Find the minimum value in the specified index.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><span class="pre">key-value</span></code>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the tuple for the first key in the index. If optional
<code class="docutils literal"><span class="pre">key-value</span></code> is supplied, returns the first key which
is greater than or equal to <code class="docutils literal"><span class="pre">key-value</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: index is not of type 'TREE'.</p>
<p>Complexity Factors: Index size, Index type.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">min</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Alpha!&#39;</span><span class="p-Indicator">,</span> <span class="nv">55</span><span class="p-Indicator">,</span> <span class="s">&#39;This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple!&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.max">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">max</code><big>(</big><span class="optional">[</span><em>key-value</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#lua-function.index_object.max" title="Ссылка на это определение">¶</a></dt>
<dd><p>Find the maximum value in the specified index.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><span class="pre">key-value</span></code>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the tuple for the last key in the index. If optional <code class="docutils literal"><span class="pre">key-value</span></code>
is supplied, returns the last key which is less than or equal to
<code class="docutils literal"><span class="pre">key-value</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Possible errors: index is not of type 'TREE'.</p>
<p>Complexity Factors: Index size, Index type.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">max</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Gamma!&#39;</span><span class="p-Indicator">,</span> <span class="nv">55</span><span class="p-Indicator">,</span> <span class="s">&#39;This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">third</span><span class="nv"> </span><span class="s">tuple!&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.random">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">random</code><big>(</big><em>random-value</em><big>)</big><a class="headerlink" href="#lua-function.index_object.random" title="Ссылка на это определение">¶</a></dt>
<dd><p>Find a random value in the specified index. This method is useful when it's
important to get insight into data distribution in an index without having
to iterate over the entire data set.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><span class="pre">random-value</span></code> (type = number) = an arbitrary non-negative integer.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the tuple for the random key in the index.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
<p>Complexity Factors: Index size, Index type.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">secondary</span><span class="p">:</span><span class="n">random</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="s">&#39;Beta!&#39;</span><span class="p-Indicator">,</span> <span class="nv">66</span><span class="p-Indicator">,</span> <span class="s">&#39;This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">second</span><span class="nv"> </span><span class="s">tuple!&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.count">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">count</code><big>(</big><em>key-value</em>, <em>options</em><big>)</big><a class="headerlink" href="#lua-function.index_object.count" title="Ссылка на это определение">¶</a></dt>
<dd><p>Iterate over an index, counting the number of
tuples which equal the provided search criteria.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><em><span class="pre">key-value</span></em></code> (type = Lua table or scalar) =
the value which must match the key(s) in the specified index. The type
may be a list of field-values, or a tuple containing only the
field-values; :samp:{options}`.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the number of matching index keys. The <code class="docutils literal"><span class="pre">count</span></code> function
is only applicable for the memtx storage engine.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">number</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong></p>
<blockquote>
<div>tarantool&gt; box.space.tester.index.primary:count(999)
---
- 0
...
tarantool&gt; box.space.tester.index.primary:count('Alpha!', { iterator = 'LE' })
---
- 1
...</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.update">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">update</code><big>(</big><em>key</em>, <em>{{operator</em>, <em>field_no</em>, <em>value}</em>, <em>...}</em><big>)</big><a class="headerlink" href="#lua-function.index_object.update" title="Ссылка на это определение">¶</a></dt>
<dd><p>Update a tuple.</p>
<p>Same as <a class="reference internal" href="box_space.html#lua-function.space_object.update" title="space_object.update"><code class="xref lua lua-func docutils literal"><span class="pre">box.space...update()</span></code></a>,
but key is searched in this index instead of primary key.
This index ought to be unique.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><span class="pre">key-value</span></code>;</li>
<li><code class="samp docutils literal"><em><span class="pre">key</span></em></code> (type = Lua table or scalar) = key to be matched against
the index key;</li>
<li><code class="samp docutils literal"><em><span class="pre">operator,</span> <span class="pre">field_no,</span> <span class="pre">value</span></em></code> (type = Lua table) = update
operations (see: <a class="reference internal" href="box_space.html#lua-function.space_object.update" title="space_object.update"><code class="xref lua lua-func docutils literal"><span class="pre">box.space...update()</span></code></a>).</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the updated tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.delete">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">delete</code><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#lua-function.index_object.delete" title="Ссылка на это определение">¶</a></dt>
<dd><p>Delete a tuple identified by a key.</p>
<p>Same as <a class="reference internal" href="box_space.html#lua-function.space_object.delete" title="space_object.delete"><code class="xref lua lua-func docutils literal"><span class="pre">box.space...delete()</span></code></a>, but key is
searched in this index instead of in the primary-key index. This index
ought to be unique.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><span class="pre">key</span></code> (type = Lua table or scalar) = key to be matched against
the index key.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">the deleted tuple.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">tuple</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.alter">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">alter</code><big>(</big><em>{options}</em><big>)</big><a class="headerlink" href="#lua-function.index_object.alter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Alter an index.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><em><span class="pre">options</span></em></code> = options list, same as the options list for
<a class="reference internal" href="box_space.html#lua-function.space_object.create_index" title="space_object.create_index"><code class="xref lua lua-func docutils literal"><span class="pre">create_index</span></code></a>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p>Possible errors: Index does not exist, or
the first index cannot be changed to {unique = false}, or
the alter function is only applicable for the memtx storage engine.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space55</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">alter</span><span class="p">({</span><span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">HASH&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.drop">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">drop</code><big>(</big><big>)</big><a class="headerlink" href="#lua-function.index_object.drop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Drop an index. Dropping a primary-key index has
a side effect: all tuples are deleted.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil.</td>
</tr>
</tbody>
</table>
<p>Possible errors: Index does not exist.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space55</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">drop</span><span class="p">()</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.rename">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">rename</code><big>(</big><em>index-name</em><big>)</big><a class="headerlink" href="#lua-function.index_object.rename" title="Ссылка на это определение">¶</a></dt>
<dd><p>Rename an index.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>;</li>
<li><code class="samp docutils literal"><em><span class="pre">index-name</span></em></code> (type = string) = new name for index.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">nil</td>
</tr>
</tbody>
</table>
<p>Possible errors: index_object does not exist.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">space55</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">secondary&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>Complexity Factors: Index size, Index type, Number of tuples accessed.</p>
</dd></dl>

<dl class="method">
<dt id="lua-function.index_object.bsize">
<em class="property"> </em><code class="descclassname">index_object:</code><code class="descname">bsize</code><big>(</big><big>)</big><a class="headerlink" href="#lua-function.index_object.bsize" title="Ссылка на это определение">¶</a></dt>
<dd><p>Return the total number of bytes taken by the index.</p>
<p>Parameters:</p>
<ul class="simple">
<li><code class="samp docutils literal"><em><span class="pre">index_object</span></em></code> = an <a class="reference internal" href="index.html#object-reference"><span>object reference</span></a>.</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">number of bytes</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">number</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<div class="section" id="example-showing-use-of-the-box-functions">
<h2>3.4.3.1. Example showing use of the box functions<a class="headerlink" href="#example-showing-use-of-the-box-functions" title="Ссылка на этот заголовок">¶</a></h2>
<p>This example will work with the sandbox configuration described in the preface.
That is, there is a space named tester with a numeric primary key. The example
function will:</p>
<ul>
<li><p class="first">select a tuple whose key value is 1000;</p>
</li>
<li><p class="first">return an error if the tuple already exists and already has 3 fields;</p>
</li>
<li><dl class="first docutils">
<dt>Insert or replace the tuple with:</dt>
<dd><ul class="first last simple">
<li>field[1] = 1000</li>
<li>field[2] = a uuid</li>
<li>field[3] = number of seconds since 1970-01-01;</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Get field[3] from what was replaced;</p>
</li>
<li><p class="first">Format the value from field[3] as yyyy-mm-dd hh:mm:ss.ffff;</p>
</li>
<li><p class="first">Return the formatted value.</p>
</li>
</ul>
<p>The function uses Tarantool box functions
<a class="reference internal" href="box_space.html#lua-function.space_object.select" title="space_object.select"><code class="xref lua lua-func docutils literal"><span class="pre">box.space...select</span></code></a>,
<a class="reference internal" href="box_space.html#lua-function.space_object.replace" title="space_object.replace"><code class="xref lua lua-func docutils literal"><span class="pre">box.space...replace</span></code></a>, <a class="reference internal" href="../../reference/fiber.html#lua-function.fiber.time" title="fiber.time"><code class="xref lua lua-func docutils literal"><span class="pre">fiber.time()</span></code></a>,
<a class="reference internal" href="../../reference/uuid.html#lua-function.uuid.str" title="uuid.str"><code class="xref lua lua-func docutils literal"><span class="pre">uuid.str()</span></code></a>. The function uses
Lua functions <a class="reference external" href="http://www.lua.org/pil/22.1.html">os.date()</a> and <a class="reference external" href="http://www.lua.org/pil/20.html">string.sub()</a>.</p>
<div class="highlight-lua"><div class="highlight"><pre><span class="k">function</span> <span class="nf">example</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">table_of_selected_tuples</span><span class="p">,</span> <span class="n">d</span>
  <span class="kd">local</span> <span class="n">replaced_tuple</span><span class="p">,</span> <span class="n">time_field</span>
  <span class="kd">local</span> <span class="n">formatted_time_field</span>
  <span class="kd">local</span> <span class="n">fiber</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">fiber&#39;</span><span class="p">)</span>
  <span class="n">table_of_selected_tuples</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">{</span><span class="mi">1000</span><span class="p">}</span>
  <span class="k">if</span> <span class="n">table_of_selected_tuples</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
    <span class="k">if</span> <span class="n">table_of_selected_tuples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
      <span class="k">if</span> <span class="o">#</span><span class="n">table_of_selected_tuples</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">then</span>
        <span class="n">box</span><span class="p">.</span><span class="n">error</span><span class="p">({</span><span class="n">code</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">This tuple already has 3 fields&#39;</span><span class="p">})</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">replaced_tuple</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">replace</span>
    <span class="p">{</span><span class="mi">1000</span><span class="p">,</span>  <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">uuid&#39;</span><span class="p">).</span><span class="n">str</span><span class="p">(),</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">fiber</span><span class="p">.</span><span class="n">time</span><span class="p">())}</span>
  <span class="n">time_field</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">replaced_tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
  <span class="n">formatted_time_field</span> <span class="o">=</span> <span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">%Y-%m-%d %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">time_field</span><span class="p">)</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">time_field</span> <span class="o">%</span> <span class="mi">1</span>
  <span class="n">d</span> <span class="o">=</span> <span class="nb">string.sub</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
  <span class="n">formatted_time_field</span> <span class="o">=</span> <span class="n">formatted_time_field</span> <span class="o">..</span> <span class="s1">&#39;</span><span class="s">.&#39;</span> <span class="o">..</span> <span class="n">d</span>
  <span class="k">return</span> <span class="n">formatted_time_field</span>
<span class="k">end</span>
</pre></div>
</div>
<p>... And here is what happens when one invokes the function:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">delete</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1000</span><span class="p-Indicator">,</span> <span class="s">&#39;264ee2da03634f24972be76c43808254&#39;</span><span class="p-Indicator">,</span> <span class="s">&#39;1391037015.6809&#39;</span><span class="p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">example</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">2014-01-29 16:11:51.1582</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">example</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">error</span><span class="p-Indicator">:</span> <span class="s">&#39;This</span><span class="nv"> </span><span class="s">tuple</span><span class="nv"> </span><span class="s">already</span><span class="nv"> </span><span class="s">has</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">fields&#39;</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="section" id="package-box-index-with-index-type-rtree-for-spatial-searches">
<span id="rtree"></span><h2>3.4.3.2. Package <cite>box.index</cite> with index type = RTREE for spatial searches<a class="headerlink" href="#package-box-index-with-index-type-rtree-for-spatial-searches" title="Ссылка на этот заголовок">¶</a></h2>
<p>The <a class="reference internal" href="#lua-module.box.index" title="box.index"><code class="xref lua lua-mod docutils literal"><span class="pre">box.index</span></code></a> package may be used for spatial searches if the index type
is RTREE. There are operations for searching <em>rectangles</em> (geometric objects
with 4 corners and 4 sides) and <em>boxes</em> (geometric objects with more than 4
corners and more than 4 sides, sometimes called hyperrectangles). This manual
uses term <em>rectangle-or-box</em> for the whole class of objects that includes both
rectangles and boxes. Only rectangles will be illustrated.</p>
<p>Rectangles are described according to their X-axis (horizontal axis) and Y-axis
(vertical axis) coordinates in a grid of arbitrary size. Here is a picture of
four rectangles on a grid with 11 horizontal points and 11 vertical points:</p>
<div class="highlight-python"><div class="highlight"><pre>           X AXIS
           1   2   3   4   5   6   7   8   9   10  11
        1
        2  #-------+                                           &lt;-Rectangle#1
Y AXIS  3  |       |
        4  +-------#
        5          #-----------------------+                   &lt;-Rectangle#2
        6          |                       |
        7          |   #---+               |                   &lt;-Rectangle#3
        8          |   |   |               |
        9          |   +---#               |
        10         +-----------------------#
        11                                     #               &lt;-Rectangle#4
</pre></div>
</div>
<p>The rectangles are defined according to this scheme: {X-axis coordinate of top
left, Y-axis coordinate of top left, X-axis coordinate of bottom right, Y-axis
coordinate of bottom right} -- or more succinctly: {x1,y1,x2,y2}. So in the
picture ... Rectangle#1 starts at position 1 on the X axis and position 2 on
the Y axis, and ends at position 3 on the X axis and position 4 on the Y axis,
so its coordinates are {1,2,3,4}. Rectangle#2's coordinates are {3,5,9,10}.
Rectangle#3's coordinates are {4,7,5,9}. And finally Rectangle#4's coordinates
are {10,11,10,11}. Rectangle#4 is actually a &quot;point&quot; since it has zero width
and zero height, so it could have been described with only two digits: {10,11}.</p>
<p>Some relationships between the rectangles are: &quot;Rectangle#1's nearest neighbor
is Rectangle#2&quot;, and &quot;Rectangle#3 is entirely inside Rectangle#2&quot;.</p>
<p>Now let us create a space and add an RTREE index.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">rectangles&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">HASH&#39;</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">}</span>
<span class="gp">         &gt; </span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">RTREE&#39;</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">ARRAY&#39;</span><span class="p">}</span>
<span class="gp">         &gt; </span><span class="p">})</span>
</pre></div>
</div>
<p>Field#1 doesn't matter, we just make it because we need a primary-key index.
(RTREE indexes cannot be unique and therefore cannot be primary-key indexes.)
The second field must be an &quot;array&quot;, which means its values must represent
{x,y} points or {x1,y1,x2,y2} rectangles. Now let us populate the table by
inserting two tuples, containing the coordinates of Rectangle#2 and Rectangle#4.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">}}</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">}}</span>
</pre></div>
</div>
<p>And now, following the description of <a class="reference internal" href="#rtree-iterator">RTREE iterator types</a>, we can search the
rectangles with these requests:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">r</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">EQ&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">2</span><span class="p-Indicator">,</span> <span class="p-Indicator">[</span><span class="nv">10</span><span class="p-Indicator">,</span> <span class="nv">11</span><span class="p-Indicator">]]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">r</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GT&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="p-Indicator">[</span><span class="nv">3</span><span class="p-Indicator">,</span> <span class="nv">5</span><span class="p-Indicator">,</span> <span class="nv">9</span><span class="p-Indicator">,</span> <span class="nv">10</span><span class="p-Indicator">]]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">r</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">NEIGHBOR&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p-Indicator">-</span> <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">1</span><span class="p-Indicator">,</span> <span class="p-Indicator">[</span><span class="nv">3</span><span class="p-Indicator">,</span> <span class="nv">5</span><span class="p-Indicator">,</span> <span class="nv">9</span><span class="p-Indicator">,</span> <span class="nv">10</span><span class="p-Indicator">]]</span>
  <span class="p-Indicator">-</span> <span class="p-Indicator">[</span><span class="nv">2</span><span class="p-Indicator">,</span> <span class="p-Indicator">[</span><span class="nv">10</span><span class="p-Indicator">,</span> <span class="nv">11</span><span class="p-Indicator">]]</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>Request#1 returns 1 tuple because the point {10,11} is the same as the rectangle
{10,11,10,11} (&quot;Rectangle#4&quot; in the picture). Request#2 returns 1 tuple because
the rectangle {4,7,5,9}, which was &quot;Rectangle#3&quot; in the picture, is entirely
within{3,5,9,10} which was Rectangle#2. Request#3 returns 2 tuples, because the
NEIGHBOR iterator always returns all tuples, and the first returned tuple will
be {3,5,9,10} (&quot;Rectangle#2&quot; in the picture) because it is the closest neighbor
of {1,2,3,4} (&quot;Rectangle#1&quot; in the picture).</p>
<p>Now let us create a space and index for cuboids, which are rectangle-or-boxes that have
6 corners and 6 sides.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">R&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">}})</span>
<span class="gp">tarantool&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">S&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">RTREE&#39;</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">dimension</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">ARRAY&#39;</span><span class="p">}</span>
<span class="gp">         &gt; </span><span class="p">})</span>
</pre></div>
</div>
<p>The additional field here is <code class="docutils literal"><span class="pre">dimension=3</span></code>. The default dimension is 2, which is
why it didn't need to be specified for the examples of rectangle. The maximum dimension
is 20. Now for insertions and selections there will usually be 6 coordinates. For example:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">}}</span>
<span class="gp">tarantool&gt; </span><span class="n">r</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">GT</span><span class="p">})</span>
</pre></div>
</div>
<p>Now let us create a space and index for Manhattan-style spatial objects, which are rectangle-or-boxes that have
a different way to calculate neighbors.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">R&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">NUM&#39;</span><span class="p">}})</span>
<span class="gp">tarantool&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">S&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">RTREE&#39;</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">unique</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">distance</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">manhattan&#39;</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">ARRAY&#39;</span><span class="p">}</span>
<span class="gp">         &gt; </span><span class="p">})</span>
</pre></div>
</div>
<p>The additional field here is <code class="docutils literal"><span class="pre">distance='manhattan'</span></code>.
The default distance calculator is 'euclid', which is the straightforward as-the-crow-flies method.
The optional distance calculator is 'manhattan', which can be a more appropriate method
if one is following the lines of a grid rather than traveling in a straight line.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">}}</span>
<span class="gp">tarantool&gt; </span><span class="n">r</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">NEIGHBOR</span><span class="p">})</span>
</pre></div>
</div>
<p>More examples of spatial searching are online in the file <a class="reference external" href="https://github.com/tarantool/tarantool/wiki/R-tree-index-quick-start-and-usage">R tree index quick
start and usage</a>.</p>
</div>
</div>


        </article>


<div class="b-page_over-tail">

    
    <a href="box_space.html" class="b-prev">3.4.2. Package <cite>box.space</cite></a>
    
    
    <a href="box_session.html" class="b-next">3.4.4. Package <cite>box.session</cite></a>
    
</div>


      </div>
    </div>
  </div>
  

      </div>
    </div>

    <!-- FOOTER > -->
    <footer class="b-footer">
      <div class="b-footer-wrapper">
        <nav class="b-footer_menu">
          
  <ul class="b-menu">
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org" class="b-menu-item-url">Overview</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://try.tarantool.org" class="b-menu-item-url">Try</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/doc/" class="b-menu-item-url p-active">Documentation</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/download.html" class="b-menu-item-url">Download</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://tarantool.org/careers.html" class="b-menu-item-url">Careers</a>
        
      </li>
    
      <li class="b-menu-item">
        
        <a href="http://rocks.tarantool.org" class="b-menu-item-url">Rocks</a>
        
      </li>
    
  </ul>

          <div class="b-footer-other">
            <a href="http://stable.tarantool.org">1.5 web site and downloads</a>
          </div>
        </nav>
      </div>
    </footer>
  <!-- < FOOTER -->
  </body>
</html>

